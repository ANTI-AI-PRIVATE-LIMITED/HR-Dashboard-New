{% extends "base.html" %}
{% block content %}

<h1 class="page-title">Job Applications</h1>
<p class="subtitle">Review and manage candidate applications</p>

<div class="action-bar" style="display:flex; gap:16px; align-items:center; margin-bottom:18px;">

    <input type="text"
           id="searchInput"
           placeholder="Search applications..."
           onkeyup="searchApplications()"
           class="search-input"
           style="width:220px">

    <div class="download-buttons" style="display:flex; gap:10px;">

        <a href="/download-excel">
            <button type="button" class="btn btn-primary">
                Download All Excel
            </button>
        </a>

        {% if selected_job %}
            <a href="/download-excel?job_id={{ selected_job }}">
                <button type="button" class="btn btn-primary">
                    Download Filtered Excel
                </button>
            </a>
        {% endif %}

    </div>
</div>

<form method="GET"
      action="/applications"
      class="filter-bar"
      style="display:flex; gap:12px; align-items:center; margin-bottom:22px;">

    <select name="job_id" class="select">
        <option value="">All Jobs</option>
        {% for job in jobs %}
            <option value="{{ job.id }}"
                {% if selected_job and selected_job == job.id|string %}selected{% endif %}>
                {{ job.title }}
            </option>
        {% endfor %}
    </select>

    <button type="submit" class="btn btn-outline">
        Filter
    </button>

</form>

<div class="card">
    <table id="applicationsTable">
        <thead>
            <tr>
                <th>Job</th>
                <th>Candidate Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Resume</th>
            </tr>
        </thead>

        <tbody>
        {% for app in applications %}
            <tr>
                <td>{{ app.job_title }}</td>
                <td>{{ app.name }}</td>
                <td>{{ app.email }}</td>
                <td>{{ app.phone }}</td>
                <td>
                    {% if app.resume_url %}
                        <a href="{{ app.resume_url }}" target="_blank">
                            Open Resume
                        </a>
                    {% else %}
                        <span style="opacity:0.6;">No Resume</span>
                    {% endif %}
                </td>
            </tr>
        {% else %}
            <tr>
                <td colspan="5" style="text-align:center; opacity:0.6;">
                    No applications found
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

<script>
function searchApplications() {
    const input = document.getElementById("searchInput").value.toLowerCase();
    document.querySelectorAll("#applicationsTable tbody tr").forEach(row => {
        row.style.display = row.innerText.toLowerCase().includes(input) ? "" : "none";
    });
}
</script>

{% endblock %}
